<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evidenƒçn√≠ syst√©m v√Ωmƒõn√≠k≈Ø</title>

    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        .toggle-btn {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
        }
        dialog {
            border: none;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <h2>Evidenƒçn√≠ syst√©m v√Ωmƒõn√≠k≈Ø</h2>

    <button onclick="showCustomerDialog()">P≈ôidat z√°kazn√≠ka</button>
    <button onclick="loadCustomers()">Naƒç√≠st z√°kazn√≠ky</button>

    <table>
        <thead>
            <tr>
                <th>N√°zev firmy</th>
                <th>Mƒõsto</th>
                <th>Ulice</th>
                <th>IƒåO</th>
                <th>Kontakt</th>
                <th>Telefon</th>
                <th>Email</th>
                <th>V√Ωmƒõn√≠ky</th> <!-- Nov√Ω sloupec pro v√Ωmƒõn√≠ky -->
            </tr>
        </thead>
        <tbody id="customersTableBody"></tbody>
    </table>

    <!-- Dialogov√© okno pro p≈ôid√°n√≠ z√°kazn√≠ka -->
    <dialog id="customerDialog">
        <h3>P≈ôidat z√°kazn√≠ka</h3>
        <form id="customerForm">
            <label>N√°zev firmy: <input type="text" id="name" required></label><br>
            <label>Mƒõsto: <input type="text" id="city" required></label><br>
            <label>Ulice: <input type="text" id="street" required></label><br>
            <label>IƒåO: <input type="text" id="ico" required></label><br>
            <label>Kontakt: <input type="text" id="contact" required></label><br>
            <label>Telefon: <input type="text" id="phone" required></label><br>
            <label>Email: <input type="email" id="email" required></label><br><br>
            <button type="submit">Ulo≈æit</button>
            <button type="button" onclick="closeCustomerDialog()">Zru≈°it</button>
        </form>
    </dialog>

    <!-- Dialog pro p≈ôid√°n√≠ v√Ωmƒõn√≠ku -->
    <dialog id="exchangerDialog">
        <h3>P≈ôidat v√Ωmƒõn√≠k</h3>
        <form id="exchangerForm">
            <label>ID v√Ωmƒõn√≠ku: <input type="text" id="exchangerId" required></label><br>
            <label>Typ v√Ωmƒõn√≠ku: <input type="text" id="exchangerType" required></label><br>
            <label>Kapacita: <input type="number" id="exchangerCapacity" required></label><br><br>
            <button type="submit">Ulo≈æit</button>
            <button type="button" onclick="closeExchangerDialog()">Zru≈°it</button>
        </form>
    </dialog>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";  

        const firebaseConfig = {
            apiKey: "AIzaSyD6KR6-j_ouZz9pZ7X1hbKDPpBYanP6qUs",
            authDomain: "test3-a06c4.firebaseapp.com",
            projectId: "test3-a06c4",
            storageBucket: "test3-a06c4.appspot.com",
            messagingSenderId: "982762948421",
            appId: "1:982762948421:web:56e67c73d435c0e00fa02c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // üìå Otev≈ôen√≠ dialogu
        window.showCustomerDialog = function() {
            document.getElementById("customerDialog").showModal();
        };

        // üìå Zav≈ôen√≠ dialogu
        window.closeCustomerDialog = function() {
            document.getElementById("customerDialog").close();
        };

        // üìå P≈ôid√°n√≠ z√°kazn√≠ka do Firestore
        window.addCustomer = async function(event) {
            event.preventDefault(); // Zabr√°n√≠ p≈ôesmƒõrov√°n√≠ formul√°≈ôe

            try {
                const docRef = await addDoc(collection(db, "customers"), {
                    name: document.getElementById("name").value,
                    city: document.getElementById("city").value,
                    street: document.getElementById("street").value,
                    ico: document.getElementById("ico").value,
                    contact: document.getElementById("contact").value,
                    phone: document.getElementById("phone").value,
                    email: document.getElementById("email").value
                });

                console.log("Z√°kazn√≠k p≈ôid√°n s ID:", docRef.id);
                closeCustomerDialog();
                loadCustomers(); // Po p≈ôid√°n√≠ znovu naƒç√≠st seznam
            } catch (e) {
                console.error("Chyba p≈ôi p≈ôid√°v√°n√≠:", e);
            }
        };

        // üìå Funkce pro naƒç√≠t√°n√≠ z√°kazn√≠k≈Ø z Firestore
        window.loadCustomers = async function() {
            let tableBody = document.getElementById("customersTableBody");

            if (!tableBody) {
                console.error("Chyba: Element customersTableBody neexistuje!");
                return;
            }

            tableBody.innerHTML = ""; // Vyƒçist√≠ tabulku

            const querySnapshot = await getDocs(collection(db, "customers"));
            
            querySnapshot.forEach((doc) => {
                let data = doc.data();
                let row = `<tr>
                    <td>${data.name}</td>
                    <td>${data.city}</td>
                    <td>${data.street}</td>
                    <td>${data.ico}</td>
                    <td>${data.contact}</td>
                    <td>${data.phone}</td>
                    <td>${data.email}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        };

        // üìå P≈ôipojen√≠ formul√°≈ôe k funkci `addCustomer`
        document.getElementById("customerForm").addEventListener("submit", addCustomer);

        // üìå Automaticky naƒç√≠st z√°kazn√≠ky p≈ôi startu
        window.onload = function() {
            loadCustomers();
        };

        // Funkce pro zobrazen√≠ a skryt√≠ v√Ωmƒõn√≠k≈Ø (glob√°ln√≠ dostupnost)
        window.toggleExchangers = function(id) {
            let row = document.getElementById(id);
            if (row.style.display === "none") {
                row.style.display = "table-row";
            } else {
                row.style.display = "none";
            }
        };

        // Funkce pro naƒç√≠t√°n√≠ v√Ωmƒõn√≠k≈Ø pro z√°kazn√≠ka (glob√°ln√≠ dostupnost)
        window.loadExchangers = function(customerId) {
            let exchangersTable = document.getElementById(`exchangers-${customerId}`);
            exchangersTable.innerHTML = ""; // Vyƒçistit tabulku v√Ωmƒõn√≠k≈Ø

            // Naƒç√≠t√°n√≠ v√Ωmƒõn√≠k≈Ø ‚Äì simulace
            for (let i = 0; i < 3; i++) {  // P≈ô√≠klad: 3 v√Ωmƒõn√≠ky
                let row = `<tr>
                    <td>V√Ωmƒõn√≠k ${i + 1}</td>
                    <td>Typ ${i + 1}</td>
                    <td>Kapacita ${i + 1}</td>
                </tr>`;
                exchangersTable.innerHTML += row;
            }

            // P≈ôid√°n√≠ pr√°zdn√©ho ≈ô√°dku pro p≈ôid√°n√≠ v√Ωmƒõn√≠ku
            let addRow = `<tr>
                <td colspan="3" style="text-align:center;">
                    <button class="toggle-btn" onclick="showExchangerDialog()">+ P≈ôidat v√Ωmƒõn√≠k</button>
                </td>
            </tr>`;
            exchangersTable.innerHTML += addRow;
        };

        // Funkce pro otev≈ôen√≠ dialogu pro p≈ôid√°n√≠ v√Ωmƒõn√≠ku (glob√°ln√≠ dostupnost)
        window.showExchangerDialog = function() {
            document.getElementById("exchangerDialog").showModal();
        };

        // Funkce pro zav≈ôen√≠ dialogu pro p≈ôid√°n√≠ v√Ωmƒõn√≠ku (glob√°ln√≠ dostupnost)
        window.closeExchangerDialog = function() {
            document.getElementById("exchangerDialog").close();
        };

        // Funkce pro p≈ôid√°n√≠ v√Ωmƒõn√≠ku (glob√°ln√≠ dostupnost)
        window.addExchanger = async function(event) {
            event.preventDefault(); // Zabr√°nit p≈ôesmƒõrov√°n√≠ formul√°≈ôe

            try {
                // Ulo≈æen√≠ v√Ωmƒõn√≠ku do Firestore (budete muset p≈ôipojit k Firestore podobnƒõ jako pro z√°kazn√≠ky)
                const docRef = await addDoc(collection(db, "exchangers"), {
                    id: document.getElementById("exchangerId").value,
                    type: document.getElementById("exchangerType").value,
                    capacity: document.getElementById("exchangerCapacity").value
                });

                console.log("V√Ωmƒõn√≠k p≈ôid√°n s ID:", docRef.id);
                closeExchangerDialog();
                loadExchangers(); // Naƒç√≠st v√Ωmƒõn√≠ky znovu po p≈ôid√°n√≠
            } catch (e) {
                console.error("Chyba p≈ôi p≈ôid√°v√°n√≠ v√Ωmƒõn√≠ku:", e);
            }
        };

// P≈ôipojen√≠ formul√°≈ôe pro v√Ωmƒõn√≠k k funkci addExchanger (glob√°ln√≠ dostupnost)
document.getElementById("exchangerForm").addEventListener("submit", addExchanger);



        // Funkce pro naƒç√≠t√°n√≠ z√°kazn√≠k≈Ø a jejich v√Ωmƒõn√≠k≈Ø
        async function loadCustomers() {
            let tableBody = document.getElementById("customersTableBody");

            if (!tableBody) {
                console.error("Chyba: Element customersTableBody neexistuje!");
                return;
            }

            tableBody.innerHTML = ""; // Vyƒçistit tabulku

            const querySnapshot = await getDocs(collection(db, "customers"));
    
            querySnapshot.forEach((doc) => {
                let data = doc.data();
                let customerId = doc.id; // Z√≠skat ID z√°kazn√≠ka pro zobrazen√≠ v√Ωmƒõn√≠k≈Ø

                let row = `<tr>
                    <td>${data.name}</td>
                    <td>${data.city}</td>
                    <td>${data.street}</td>
                    <td>${data.ico}</td>
                    <td>${data.contact}</td>
                    <td>${data.phone}</td>
                    <td>${data.email}</td>
                    <td>
                        <button class="toggle-btn" onclick="toggleExchangers('exchangers-${customerId}')">&#9660;</button>
                    </td>
                </tr>`;
        
                // P≈ôidat z√°kazn√≠ka do tabulky
                tableBody.innerHTML += row;

                // P≈ôidat seznam v√Ωmƒõn√≠k≈Ø pro z√°kazn√≠ka
                let exchangersRow = `<tr id="exchangers-${customerId}" style="display:none;">
                    <td colspan="8">
                        <table>
                            <thead>
                                <tr><th>V√Ωmƒõn√≠k</th><th>Typ</th><th>Kapacita</th></tr>
                            </thead>
                            <tbody id="exchangers-${customerId}"></tbody>
                        </table>
                    </td>
                </tr>`;
                tableBody.innerHTML += exchangersRow;

                // Naƒç√≠st v√Ωmƒõn√≠ky pro tohoto z√°kazn√≠ka
                loadExchangers(customerId);
            });
        }
        
    </script>

</body>
</html>
